# Experiment Configuration for CounterFactual DiCE
# This file defines all parameters for running counterfactual generation experiments using DiCE
# For comparison with DPG method - see iris.yaml

experiment:
  name: "counterfactual_dice_v1"
  project: "counterfactual-dpg"  # wandb project name
  entity: "mllab-ts-universit-di-trieste"
  tags: ["baseline", "iris", "dice"]
  notes: "DiCE counterfactual generation for comparison with DPG"

data:
  dataset: "iris"  # Support for future datasets
  test_size: 0.3
  random_state: 42
  # Feature type specifications (optional - will auto-detect if not specified)
  # continuous_features: ["sepal length (cm)", "sepal width (cm)", "petal length (cm)", "petal width (cm)"]
  # categorical_features: []
  # variable_features: null  # null = all features are actionable

model:
  type: "RandomForestClassifier"
  n_estimators: 3
  random_state: 42

counterfactual:
  # Method selection: "dpg" or "dice"
  method: "dice"
  
  # DiCE-specific parameters
  # Number of counterfactuals to generate per query
  total_CFs: 4
  
  # DiCE generation method: "random", "kdtree", "genetic"
  # - random: Fast but may not find optimal CFs
  # - kdtree: Uses training data to find CFs (requires training data)
  # - genetic: Uses genetic algorithm (similar to DPG approach)
  generation_method: "genetic"
  
  # Weight for being close to the original instance (higher = closer CFs)
  proximity_weight: 0.5
  
  # Weight for generating diverse counterfactuals (higher = more diverse)
  diversity_weight: 1.0
  
  # Actionability rules (same format as DPG for consistency)
  # Features not listed = fully actionable ("all")
  # Per-feature constraints can be specified as:
  #   - permitted_range: {feature_name: [min, max]}
  #   - features_to_vary: list of actionable features (all others frozen)
  rules: ["none"]  # Legacy compatibility
  
  # Per-feature actionability (preferred - same format as DPG)
  # actionability:
  #   feature_name: "no_change"  # Frozen feature
  #   feature_name: "non_increasing"  # Can only decrease
  #   feature_name: "non_decreasing"  # Can only increase
  
  # Optional: Permitted ranges for features (DiCE-specific)
  # permitted_range:
  #   sepal length (cm): [4.0, 8.0]
  #   petal width (cm): [0.1, 2.5]
  
  # Optional: Feature weights for change difficulty (higher = harder to change)
  # feature_weights:
  #   sepal length (cm): 1.0
  #   petal width (cm): 2.0
  
  # ---- DPG parameters below (kept for reference, not used with DiCE) ----
  # These are ignored when method="dice" but kept for easy switching
  # GA hyperparameters (from CounterFactualModel)
  diversity_weight_dpg: 1.5
  repulsion_weight: 2.0
  boundary_weight: 12.0
  distance_factor: 1.5
  sparsity_factor: 1.0
  constraints_factor: 3.0
  
  # Dual-boundary parameters
  original_escape_weight: 2.0
  escape_pressure: 0.5
  prioritize_non_overlapping: true
  max_bonus_cap: 50.0
  
  # Runtime parameters (used by both methods where applicable)
  population_size: 50
  max_generations: 60
  mutation_rate: 0.3
  delta_threshold: 0.01
  patience: 20

experiment_params:
  seed: 42
  sample_indices: [2]  # null = random, or list like [0, 5, 10]
  num_samples: 1 
  num_combinations_to_test: 1 
  num_replications: 3
  compute_comprehensive_metrics: true  # Enable comprehensive ECE-style metrics
  parallel_replications: true  # Enable parallel execution of replications
  max_workers: null  # null = use (CPU_count - 1), or specify a number

output:
  local_dir: "experiment_results"
  save_visualizations: true
  save_raw_data: true
  save_visualization_images: true
